### 任务调度
---

#### 节点组成
中心调度服务以环状结构管理集群中的所有节点，所组成的集群按 `Runtime` 划分，每一个 `Runtime` 下的 `N` 个节点组成一个 `hash` 环结构，节点一但成功加入到某个 `Runtime` 后，就将开始分担 `Runtime` 中的部分任务。不是所有的节点都可以被中心调度服务发现，前提是必须在前端 `Runtimes` 管理中为当前 `Runtime` 的 `Servers` 属性加入待发现节点的 IP 地址，否则即便发现节点也会被视为无效，放弃加入集群。 

#### 分配原则

> 默认分配   

所有任务只会在所属 `Runtime` 的工作节点中分配，不会被垮越 `Runtime` 分配，以此来保证统一的运行时环境，若在 `Runtime` 下所有的工作节点都离线或宕机，那么当前 `Runtime` 下所有任务都将处于分配失败状态 `reallocating`，否则任务始终会被分配到某个节点上。

> 局部分配

任务可以根据选择的 `Target Server` 来分配，基于默认分配原则，这些 `Server` 都来至于相同的 `Runtime`，只是范围更小了些，调度器始终在选择的 `Server` 中来分配节点，若 `Target Server` 中的服务器都离线或宕机，那么任务也将处于分配失败状态 `reallocating`。

#### 触发调度
当创建、修改、删除一个任务时，调度器会对任务立即调度一次，为了防止任务分配抖动，当分配好工作节点后一般很少再改变，`Runtime` 中若有工作节点上下线时，调度器会对任务重新分配一次，在分配过程中，若有任务正在执行会被强制终止。
